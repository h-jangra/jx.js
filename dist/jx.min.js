const t=new class{constructor(){this.templates=/* @__PURE__ */new Map}init(){this.loadTemplates(),this.bindEvents()}loadTemplates(){document.querySelectorAll("template[id]").forEach(t=>{this.templates.set(t.id,t)})}bindEvents(){document.addEventListener("click",t=>{const e=t.target.closest("[jx-get], [jx-post]");e&&(t.preventDefault(),this.handleTrigger(e))})}async handleTrigger(t){const e={url:t.getAttribute("jx-get")||t.getAttribute("jx-post"),method:t.hasAttribute("jx-post")?"POST":"GET",target:t.getAttribute("jx-target"),template:t.getAttribute("jx-template")};await this.render(e)}async render({url:t,method:e="GET",target:r,template:s}){const i=document.querySelector(r),a=this.templates.get(s);if(i&&a){i.innerHTML='<div class="jx-loading">Loading...</div>';try{const r=await fetch(t,{method:e});if(!r.ok)throw new Error(`HTTP ${r.status}`);const s=await r.json();this.renderTemplate(i,a,s)}catch(n){i.innerHTML=`<div class="jx-error">Error: ${n.message}</div>`}}}renderTemplate(t,e,r){const s=e.content.cloneNode(!0);this.interpolate(s,r),t.innerHTML="",t.appendChild(s)}interpolate(t,e){if(t.nodeType!==Node.TEXT_NODE){if(t.nodeType===Node.ELEMENT_NODE){if(Array.from(t.attributes).forEach(r=>{r.value.includes("{{")&&t.setAttribute(r.name,this.replacePlaceholders(r.value,e))}),t.hasAttribute("jx-each"))return void this.handleLoop(t,e);if(t.hasAttribute("jx-if")&&!this.handleConditional(t,e))return}t.childNodes&&Array.from(t.childNodes).forEach(t=>{this.interpolate(t,e)})}else t.textContent=this.replacePlaceholders(t.textContent,e)}replacePlaceholders(t,e){return t.replace(/\{\{\s*([^}]+)\s*\}\}/g,(t,r)=>{const s=this.get(e,r.trim());return null!=s?String(s):""})}handleLoop(t,e){const r=t.getAttribute("jx-each"),s=this.get(e,r);if(!Array.isArray(s))return void t.remove();const i=t.parentNode,a=t.cloneNode(!0);a.removeAttribute("jx-each");const n=Array.from(i.childNodes).indexOf(t);-1!==n&&i.removeChild(t),s.forEach((t,e)=>{const r=a.cloneNode(!0);r.setAttribute("data-index",e),this.interpolate(r,t),i.insertBefore(r,i.childNodes[n+e])})}handleConditional(t,e){const r=t.getAttribute("jx-if");return this.get(e,r)?(t.removeAttribute("jx-if"),!0):(t.remove(),!1)}get(t,e){return"."===e||"this"===e?t:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}async load(t,{target:e,template:r,method:s="GET"}){return this.render({url:t,method:s,target:e,template:r})}bind(t,e){const r=document.querySelector(t);r&&(r.setAttribute("jx-get",e.url||""),r.setAttribute("jx-target",e.target),r.setAttribute("jx-template",e.template),"POST"===e.method&&(r.setAttribute("jx-post",e.url||""),r.removeAttribute("jx-get")))}};t.init();export{t as default};
