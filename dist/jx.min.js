class t{constructor(){this.templates=/* @__PURE__ */new Map,document.querySelectorAll("template[id]").forEach(t=>{this.templates.set(t.id,t)}),document.addEventListener("click",t=>{const e=t.target.closest("[jx-get], [jx-post]");e&&(t.preventDefault(),this.handleTrigger(e))})}async handleTrigger(t){const e=t.getAttribute("jx-get")||t.getAttribute("jx-post"),o=t.hasAttribute("jx-post")?"POST":"GET",s=t.getAttribute("jx-save");await this.render({url:e,method:o,target:t.getAttribute("jx-target"),template:t.getAttribute("jx-template"),save:s})}async render(t){const e=document.querySelector(t.target),o=this.templates.get(t.template);if(e&&o)try{e.innerHTML="Loading...";const s=await fetch(t.url,{method:t.method}),a=await s.json();t.save&&localStorage.setItem(t.save,JSON.stringify(a)),this.renderTemplate(e,o,a)}catch(s){e.innerHTML=`<div>Error: ${s.message}</div>`}}renderTemplate(t,e,o){const s=e.content.cloneNode(!0);this.interpolate(s,o),t.innerHTML="",t.appendChild(s)}interpolate(t,e){var o,s;t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("jx-each")?this.handleLoop(t,e):(t.nodeType===Node.TEXT_NODE&&(t.textContent=t.textContent.replace(/\{\{([^}]+)\}\}/g,(t,o)=>{var s;return null!=(s=this.get(e,o.trim()))?s:""})),t.nodeType!==Node.ELEMENT_NODE||(Array.from(t.attributes).forEach(o=>{o.value.includes("{{")&&t.setAttribute(o.name,o.value.replace(/\{\{([^}]+)\}\}/g,(t,o)=>{var s;return null!=(s=this.get(e,o.trim()))?s:""}))}),!t.hasAttribute("jx-if")||this.get(e,t.getAttribute("jx-if")))?(null==(o=t.hasAttribute)?void 0:o.call(t,"jx-each"))||null==(s=t.childNodes)||s.forEach(t=>this.interpolate(t,e)):t.remove())}handleLoop(t,e){const o=t.getAttribute("jx-each"),s="."===o?e:this.get(e,o);if(!Array.isArray(s))return void t.remove();const a=t.parentNode,n=t.cloneNode(!0);n.removeAttribute("jx-each");const c=t.nextSibling;t.remove(),s.forEach((t,e)=>{const o=n.cloneNode(!0);this.interpolate(o,t),c?a.insertBefore(o,c):a.appendChild(o)})}get(t,e){return"."===e||"this"===e?t:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}static json(t,o,s){const a="string"==typeof t?document.getElementById(t):t,n="string"==typeof o?document.querySelector(o):o;a&&n&&e.renderTemplate(n,a,s)}static bind(t,e){const o=document.querySelector(t);o&&(o.setAttribute("jx-get",e.url),o.setAttribute("jx-target",e.target),o.setAttribute("jx-template",e.template),e.save&&o.setAttribute("jx-save",e.save),"POST"===e.method&&(o.setAttribute("jx-post",e.url),o.removeAttribute("jx-get")))}static loadCached(e,o,s){const a=localStorage.getItem(e);return!!a&&(t.json(o,s,JSON.parse(a)),!0)}}const e=new t;
