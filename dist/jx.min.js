class t{constructor(){this.templates=/* @__PURE__ */new Map,document.querySelectorAll("template[id]").forEach(t=>{this.templates.set(t.id,t)}),document.addEventListener("click",t=>{const e=t.target.closest("[jx-get], [jx-post]");e&&(t.preventDefault(),this.handleTrigger(e))})}async handleTrigger(t){const e=t.getAttribute("jx-get")||t.getAttribute("jx-post"),o=t.hasAttribute("jx-post")?"POST":"GET";await this.render({url:e,method:o,template:t.getAttribute("jx-template"),save:t.getAttribute("jx-save")})}async render(t){const e=this.templates.get(t.template);if(e)try{const o=await fetch(t.url,{method:t.method});if(!o.ok)throw new Error(`HTTP ${o.status}`);const s=await o.json();t.save&&localStorage.setItem(t.save,JSON.stringify(s)),this.renderTemplate(e,s)}catch(o){this.renderError(e,o.message)}}renderTemplate(t,e){const o=t.content.cloneNode(!0);this.interpolate(o,e),t.replaceWith(o)}renderError(t,e){const o=document.createElement("div");o.className="jx-error",o.textContent=`Error: ${e}`,t.replaceWith(o)}interpolate(t,e){var o,s;t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("jx-each")?this.handleLoop(t,e):(t.nodeType===Node.TEXT_NODE&&(t.textContent=t.textContent.replace(/\{\{([^}]+)\}\}/g,(t,o)=>{var s;return null!=(s=this.get(e,o.trim()))?s:""})),t.nodeType!==Node.ELEMENT_NODE||(Array.from(t.attributes).forEach(o=>{o.value.includes("{{")&&t.setAttribute(o.name,o.value.replace(/\{\{([^}]+)\}\}/g,(t,o)=>{var s;return null!=(s=this.get(e,o.trim()))?s:""}))}),!t.hasAttribute("jx-if")||this.get(e,t.getAttribute("jx-if")))?(null==(o=t.hasAttribute)?void 0:o.call(t,"jx-each"))||null==(s=t.childNodes)||s.forEach(t=>this.interpolate(t,e)):t.remove())}handleLoop(t,e){const o=t.getAttribute("jx-each"),s="."===o?e:this.get(e,o);if(!Array.isArray(s))return void t.remove();const r=t.parentNode,n=t.cloneNode(!0);n.removeAttribute("jx-each");const a=t.nextSibling;t.remove(),s.forEach(t=>{const e=n.cloneNode(!0);this.interpolate(e,t),a?r.insertBefore(e,a):r.appendChild(e)})}get(t,e){return"."===e||"this"===e?t:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}static json(t,o){const s="string"==typeof t?document.getElementById(t):t;s&&e.renderTemplate(s,o)}static bind(t,e){const o=document.querySelector(t);o&&(o.setAttribute("jx-get",e.url),o.setAttribute("jx-template",e.template),e.save&&o.setAttribute("jx-save",e.save),"POST"===e.method&&(o.setAttribute("jx-post",e.url),o.removeAttribute("jx-get")))}static loadCached(e,o){const s=localStorage.getItem(e);return!!s&&(t.json(o,JSON.parse(s)),!0)}}const e=new t;
