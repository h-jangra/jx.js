!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";class t{constructor(){this.templates=/* @__PURE__ */new Map,document.querySelectorAll("template[id]").forEach(t=>{this.templates.set(t.id,t)}),document.addEventListener("click",t=>{const e=t.target.closest("[jx-get], [jx-post]");e&&(t.preventDefault(),this.handleTrigger(e))})}async handleTrigger(t){const e=t.getAttribute("jx-get")||t.getAttribute("jx-post"),n=t.hasAttribute("jx-post")?"POST":"GET";await this.render({url:e,method:n,template:t.getAttribute("jx-template"),save:t.getAttribute("jx-save")})}async render(t){const e=this.templates.get(t.template);if(e)try{const n=await fetch(t.url,{method:t.method});if(!n.ok)throw new Error(`HTTP ${n.status}`);const o=await n.json();t.save&&localStorage.setItem(t.save,JSON.stringify(o)),this.renderTemplate(e,o)}catch(n){this.renderError(e,n.message)}}renderTemplate(t,e){const n=t.content.cloneNode(!0);this.interpolate(n,e),t.replaceWith(n)}renderError(t,e){const n=document.createElement("div");n.className="jx-error",n.textContent=`Error: ${e}`,t.replaceWith(n)}interpolate(t,e){var n,o;t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("jx-each")?this.handleLoop(t,e):(t.nodeType===Node.TEXT_NODE&&(t.textContent=t.textContent.replace(/\{\{([^}]+)\}\}/g,(t,n)=>{var o;return null!=(o=this.get(e,n.trim()))?o:""})),t.nodeType!==Node.ELEMENT_NODE||(Array.from(t.attributes).forEach(n=>{n.value.includes("{{")&&t.setAttribute(n.name,n.value.replace(/\{\{([^}]+)\}\}/g,(t,n)=>{var o;return null!=(o=this.get(e,n.trim()))?o:""}))}),!t.hasAttribute("jx-if")||this.get(e,t.getAttribute("jx-if")))?(null==(n=t.hasAttribute)?void 0:n.call(t,"jx-each"))||null==(o=t.childNodes)||o.forEach(t=>this.interpolate(t,e)):t.remove())}handleLoop(t,e){const n=t.getAttribute("jx-each"),o="."===n?e:this.get(e,n);if(!Array.isArray(o))return void t.remove();const s=t.parentNode,r=t.cloneNode(!0);r.removeAttribute("jx-each");const c=t.nextSibling;t.remove(),o.forEach(t=>{const e=r.cloneNode(!0);this.interpolate(e,t),c?s.insertBefore(e,c):s.appendChild(e)})}get(t,e){return"."===e||"this"===e?t:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}static json(t,n){const o="string"==typeof t?document.getElementById(t):t;o&&e.renderTemplate(o,n)}static bind(t,e){const n=document.querySelector(t);n&&(n.setAttribute("jx-get",e.url),n.setAttribute("jx-template",e.template),e.save&&n.setAttribute("jx-save",e.save),"POST"===e.method&&(n.setAttribute("jx-post",e.url),n.removeAttribute("jx-get")))}static loadCached(e,n){const o=localStorage.getItem(e);return!!o&&(t.json(n,JSON.parse(o)),!0)}}const e=new t});
