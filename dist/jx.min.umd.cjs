!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).JX=e()}(this,function(){"use strict";const t=new class{constructor(){this.templates=/* @__PURE__ */new Map}init(){this.loadTemplates(),this.bindEvents()}loadTemplates(){document.querySelectorAll("template[id]").forEach(t=>{this.templates.set(t.id,t)})}bindEvents(){document.addEventListener("click",t=>{const e=t.target.closest("[jx-get], [jx-post]");e&&(t.preventDefault(),this.handleTrigger(e))})}async handleTrigger(t){const e={url:t.getAttribute("jx-get")||t.getAttribute("jx-post"),method:t.hasAttribute("jx-post")?"POST":"GET",target:t.getAttribute("jx-target"),template:t.getAttribute("jx-template")};await this.render(e)}async render({url:t,method:e="GET",target:i,template:n}){const o=document.querySelector(i),s=this.templates.get(n);if(o&&s){o.innerHTML='<div class="jx-loading">Loading...</div>';try{const i=await fetch(t,{method:e});if(!i.ok)throw new Error(`HTTP ${i.status}`);const n=await i.json();this.renderTemplate(o,s,n)}catch(r){o.innerHTML=`<div class="jx-error">Error: ${r.message}</div>`}}}renderTemplate(t,e,i){const n=e.content.cloneNode(!0);this.interpolate(n,i),t.innerHTML="",t.appendChild(n)}interpolate(t,e){if(t.nodeType!==Node.TEXT_NODE){if(t.nodeType===Node.ELEMENT_NODE){if(Array.from(t.attributes).forEach(i=>{i.value.includes("{{")&&t.setAttribute(i.name,this.replacePlaceholders(i.value,e))}),t.hasAttribute("jx-each"))return void this.handleLoop(t,e);if(t.hasAttribute("jx-if")&&!this.handleConditional(t,e))return}t.childNodes&&Array.from(t.childNodes).forEach(t=>{this.interpolate(t,e)})}else t.textContent=this.replacePlaceholders(t.textContent,e)}replacePlaceholders(t,e){return t.replace(/\{\{\s*([^}]+)\s*\}\}/g,(t,i)=>{const n=this.get(e,i.trim());return null!=n?String(n):""})}handleLoop(t,e){const i=t.getAttribute("jx-each"),n=this.get(e,i);if(!Array.isArray(n))return void t.remove();const o=t.parentNode,s=t.cloneNode(!0);s.removeAttribute("jx-each");const r=Array.from(o.childNodes).indexOf(t);-1!==r&&o.removeChild(t),n.forEach((t,e)=>{const i=s.cloneNode(!0);i.setAttribute("data-index",e),this.interpolate(i,t),o.insertBefore(i,o.childNodes[r+e])})}handleConditional(t,e){const i=t.getAttribute("jx-if");return this.get(e,i)?(t.removeAttribute("jx-if"),!0):(t.remove(),!1)}get(t,e){return"."===e||"this"===e?t:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}async load(t,{target:e,template:i,method:n="GET"}){return this.render({url:t,method:n,target:e,template:i})}bind(t,e){const i=document.querySelector(t);i&&(i.setAttribute("jx-get",e.url||""),i.setAttribute("jx-target",e.target),i.setAttribute("jx-template",e.template),"POST"===e.method&&(i.setAttribute("jx-post",e.url||""),i.removeAttribute("jx-get")))}};return t.init(),t});
