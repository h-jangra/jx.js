!function(t){"function"==typeof define&&define.amd?define(t):t()}(function(){"use strict";class t{constructor(){this.templates=/* @__PURE__ */new Map,document.querySelectorAll("template[id]").forEach(t=>{this.templates.set(t.id,t)}),document.addEventListener("click",t=>{const e=t.target.closest("[jx-get], [jx-post]");e&&(t.preventDefault(),this.handleTrigger(e))})}async handleTrigger(t){const e=t.getAttribute("jx-get")||t.getAttribute("jx-post"),n=t.hasAttribute("jx-post")?"POST":"GET",o=t.getAttribute("jx-save");await this.render({url:e,method:n,target:t.getAttribute("jx-target"),template:t.getAttribute("jx-template"),save:o})}async render(t){const e=document.querySelector(t.target),n=this.templates.get(t.template);if(e&&n)try{e.innerHTML="Loading...";const o=await fetch(t.url,{method:t.method}),s=await o.json();t.save&&localStorage.setItem(t.save,JSON.stringify(s)),this.renderTemplate(e,n,s)}catch(o){e.innerHTML=`<div>Error: ${o.message}</div>`}}renderTemplate(t,e,n){const o=e.content.cloneNode(!0);this.interpolate(o,n),t.innerHTML="",t.appendChild(o)}interpolate(t,e){var n,o;t.nodeType===Node.ELEMENT_NODE&&t.hasAttribute("jx-each")?this.handleLoop(t,e):(t.nodeType===Node.TEXT_NODE&&(t.textContent=t.textContent.replace(/\{\{([^}]+)\}\}/g,(t,n)=>{var o;return null!=(o=this.get(e,n.trim()))?o:""})),t.nodeType!==Node.ELEMENT_NODE||(Array.from(t.attributes).forEach(n=>{n.value.includes("{{")&&t.setAttribute(n.name,n.value.replace(/\{\{([^}]+)\}\}/g,(t,n)=>{var o;return null!=(o=this.get(e,n.trim()))?o:""}))}),!t.hasAttribute("jx-if")||this.get(e,t.getAttribute("jx-if")))?(null==(n=t.hasAttribute)?void 0:n.call(t,"jx-each"))||null==(o=t.childNodes)||o.forEach(t=>this.interpolate(t,e)):t.remove())}handleLoop(t,e){const n=t.getAttribute("jx-each"),o="."===n?e:this.get(e,n);if(!Array.isArray(o))return void t.remove();const s=t.parentNode,i=t.cloneNode(!0);i.removeAttribute("jx-each");const a=t.nextSibling;t.remove(),o.forEach((t,e)=>{const n=i.cloneNode(!0);this.interpolate(n,t),a?s.insertBefore(n,a):s.appendChild(n)})}get(t,e){return"."===e||"this"===e?t:e.split(".").reduce((t,e)=>null==t?void 0:t[e],t)}static json(t,n,o){const s="string"==typeof t?document.getElementById(t):t,i="string"==typeof n?document.querySelector(n):n;s&&i&&e.renderTemplate(i,s,o)}static bind(t,e){const n=document.querySelector(t);n&&(n.setAttribute("jx-get",e.url),n.setAttribute("jx-target",e.target),n.setAttribute("jx-template",e.template),e.save&&n.setAttribute("jx-save",e.save),"POST"===e.method&&(n.setAttribute("jx-post",e.url),n.removeAttribute("jx-get")))}static loadCached(e,n,o){const s=localStorage.getItem(e);return!!s&&(t.json(n,o,JSON.parse(s)),!0)}}const e=new t});
